{% extends "blog/base.html" %}
{% load crispy_forms_tags %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}

<div class="container mt-4">

    <!-- Post Card -->
    <div class="card shadow-lg border-0">
        <div class="card-body">

            <h2 class="fw-bold">{{ post.title }}</h2>

            <p class="text-muted mb-1">
                By <strong>{{ post.author }}</strong> â€¢ {{ post.created_at|date:"F d, Y" }}
            </p>

            <!-- Category -->
            <p class="mb-2">
                <span class="badge bg-dark">{{ post.category.name }}</span>
            </p>

            <!-- Tags -->
            <p>
                <strong>Tags:</strong>
                {% for tag in post.tag.all %}
                    <span class="badge bg-primary mx-1">#{{ tag.name }}</span>
                {% empty %}
                    <span class="text-muted">No tags</span>
                {% endfor %}
            </p>

            <hr>

            <!-- Blog Content -->
            <p class="mt-3" style="font-size: 1.1rem; line-height: 1.7;">
                {{ post.content|safe }}
            </p>

            <hr>

            <!-- Like/Unlike + Stats -->
            <div class="d-flex align-items-center gap-3">

                {% if is_liked %}
                <a href="{% url 'like_post' post.id %}" class="btn btn-danger btn-sm">â¤ï¸ Unlike</a>
                {% else %}
                <a href="{% url 'like_post' post.id %}" class="btn btn-primary btn-sm">ğŸ‘ Like</a>
                {% endif %}

                <span class="badge bg-success">â¤ï¸ {{ like_count }}</span>
                <span class="badge bg-info text-dark">ğŸ‘ï¸ {{ post.view_count }}</span>
                {% if user.is_authenticated and user == post.author%}
                <a href="{% url 'post_update' post.id %}" class="btn btn-warning btn-sm">âœ Edit</a>
                <a href="{% url 'post_delete' post.id %}" class="btn btn-danger btn-sm">ğŸ—‘ Delete</a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Comments Section -->
    <div class="card mt-4 shadow-sm">
        <div class="card-header fw-bold">
            ğŸ’¬ Comments
        </div>

        <div class="card-body">

            <!-- Add Comment Form -->
            <form method="post" class="mb-3">
                {% csrf_token %}
                {{ comment_form|crispy }}
                <button type="submit" class="btn btn-primary btn-sm">â• Add Comment</button>
            </form>

            <hr>

            <!-- Display Comments -->
            {% for comment in comments %}
            <div class="p-2 mb-3 border-bottom">
                <h6 class="mb-0">{{ comment.author }}</h6>
                <small class="text-muted">{{ comment.created_at|date:'F d, Y h:i A' }}</small>
                <p class="mb-1">{{ comment.content }}</p>
            </div>

            {% empty %}
            <p class="text-muted">No comments yet. Be the first to comment ğŸ˜Š</p>
            {% endfor %}

        </div>
    </div>

</div>

{% endblock %}
